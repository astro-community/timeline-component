import e,{createContext as t,useContext as r,createElement as n,useState as a}from"react";let append=(e,...t)=>e.append(...t)||e,assign=(e,t,...r)=>{for(let r in t)e.setAttribute(r,t[r]);return append(e,...r)};function from(e,t=null,...r){return assign(document.createElement(e),t,...r)}function fromSVG(e,t=null,...r){return assign(document.createElementNS("http://www.w3.org/2000/svg",e),t,...r)}function Div(e=null,...t){let r=from("div",e,...t),{prototype:n}=new.target||HTMLElement;return n.constructor!==HTMLElement&&Object.setPrototypeOf(r,n),r}Div.prototype=HTMLElement.prototype;let i=new function WeakRef(e=((e,t)=>Object(t))){let t=new WeakMap;return(r,...n)=>{let a=t.get(r);return a||t.set(r,a=e(r,...n)),a}}(((e,t)=>{let r,n,a,i,l={host:e,parts:{},props:{},style:{},get shadowRoot(){return n||(n=e.attachShadow({mode:"open"}))},get shadowSlotElement(){return a||(a=l.shadowRoot.appendChild(document.createElement("slot")))},get shadowStyleElement(){return i||(i=l.shadowRoot.appendChild(document.createElement("style")))},setProps(e){let t=l.props;for(let r in e){let n=t[r],a=e[r];n!==a&&(t[r]=a,l.onPropsChange(r,n,a))}},onPropsChange(){},setStyle(e){for(let t in e)l.style[t]=e[t];!function update(){cancelAnimationFrame(r);let{sheet:e}=l.shadowStyleElement;if(e){let t=(e.cssRules[0]||e.cssRules[e.insertRule(":host{")]).style;for(let e in l.style)e.includes("-")?t.setProperty(e,l.style[e]):t[e]=l.style[e]}else r=requestAnimationFrame(update)}()},...Object(t)};return l})),defineElementInternals=(e,t)=>{let{prototype:r}=e;for(let e in t)Object.defineProperty(r,e,{configurable:!0,get(){return i(this).props[e]},set(r){i(this).setProps({[e]:t[e](r)})}})},getTime=(e=0)=>new Date(e).getTime()||0,getTimeISO=(e=0,t=null)=>{let r=new Date(getTime(e)).toISOString(),n={YYYY:r.slice(0,4),MM:r.slice(5,7),DD:r.slice(8,10),hh:r.slice(11,13),mm:r.slice(14,16),ss:r.slice(17,19),ms:r.slice(20,24)};return String(t).replace(/\{([^}]+)\}/g,((e,t)=>n[t]||e))},format_MMYYYY=e=>({divide:e,format:e=>getTimeISO(e,"{MM}/{YYYY}")}),format_MMDD=e=>({divide:e,format:e=>getTimeISO(e,"{MM}/{DD}")}),format_hhmm=e=>({divide:e,format:e=>getTimeISO(e,"{hh}:{mm}")}),format_mmss=e=>({divide:e,format:e=>getTimeISO(e,"{mm}:{ss}")}),format_ssms=e=>({divide:e,format:e=>getTimeISO(e,"{ss}:{ms}")}),l=[format_ssms(100),format_ssms(250),format_mmss(1e3),format_mmss(5e3),format_mmss(1e4),format_mmss(2e4),format_mmss(3e4),format_hhmm(6e4),format_hhmm(6e4),format_hhmm(12e4),format_hhmm(3e5),format_hhmm(6e5),format_hhmm(12e5),format_hhmm(18e5),format_hhmm(36e5),format_hhmm(72e5),format_hhmm(108e5),format_hhmm(216e5),format_hhmm(432e5),format_MMDD(864e5),format_MMDD(6048e5),format_MMYYYY(2609875862.0689654)];class TimelineRuler extends Div{constructor(){super({class:"ruler",part:"ruler"}),i(this,{props:{stepper:{divide:0,format:()=>""}}}),this.repaint()}repaint(){let e=this,t=e.getRootNode()?.host;if(!t||e===t)return;let r=i(e),n=i(t),a=r.props.stepper,s=l.find((e=>e.divide/n.props.msPerPx*n.props.zoom>=60))||l.at(-1);a!==s&&(r.props.stepper=s,e.redraw())}redraw(){let e=this,t=e.getRootNode()?.host;if(!t||e===t)return;let r=i(e),n=i(t),{stepper:a}=r.props;n.setProps({rulerMsPerStep:a.divide});let l=[];for(let e=n.props.startTime,t=n.props.endTime;e<t;e+=a.divide)l.push(new from("div",{class:"ruler-step",part:"ruler-step"},a.format(e)));e.replaceChildren(...l)}}class TimelineTrackHeaderElement extends Div{constructor(){super();let{parts:e}=i(this);assign(this,{class:"track-fragment",part:"track-container"}),append(this,new from("div",{class:"track-header",part:"track-header"},e.toggle=new from("button",{type:"button",class:"toggle",part:"toggle"},new fromSVG("svg",{class:"toggle-symbol",part:"toggle-symbol",viewBox:"0 0 24 24"},new fromSVG("path",{d:"M9.29 15.88 13.17 12 9.29 8.12a.996.996 0 1 1 1.41-1.41l4.59 4.59c.39.39.39 1.02 0 1.41L10.7 17.3a.996.996 0 0 1-1.41 0c-.38-.39-.39-1.03 0-1.42Z"}))),e.content=new from("div")),e.tracks=new from("div",{class:"tracks",part:"tracks"}))}}class TimelineEvent extends Div{constructor(e=null){e=Object(e),super();let t=new DocumentFragment,r=new MutationObserver((()=>{r.disconnect(),n.parts.content.replaceChildren(t),r.observe(t,{childList:!0})}));r.observe(t,{childList:!0});let n=i(this,{props:{startTime:0,endTime:0,status:"normal",get content(){return t},set content(e){n.parts.content.replaceChildren(e)}},onPropsChange(e,t,r){switch(e){case"startTime":n.setStyle({"--TimelineEventOpening":r});break;case"endTime":n.setStyle({"--TimelineEventClosing":r});break;case"status":this.host.classList.toggle("status-"+t,!1),this.host.classList.toggle("status-"+r,!0),this.host.part.toggle("status-"+t,!1),this.host.part.toggle("status-"+r,!0)}}});n.parts.content=new from("div",{class:"event-content",part:"event-content"}),assign(this,{class:"event",part:"event"}),this.append(n.parts.content),this.endTime=e.endTime,this.startTime=e.startTime,this.status=e.status,this.content=e.content}get startTime(){}set startTime(e){}get endTime(){}set endTime(e){}get status(){}set status(e){}get content(){}set content(e){}}defineElementInternals(TimelineEvent,{startTime:getTime,endTime:getTime,status:e=>null==e?"":String(e),content:e=>e});class TimelineTrack extends Div{constructor(e=null){e=Object(e),super();let{props:t,parts:r,setProps:n}=i(this,{props:{header:new DocumentFragment,open:!0},onPropsChange(e,t,n){switch(e){case"header":i(r.header).parts.content.replaceChildren(n);break;case"open":this.host.classList.toggle("open",n),this.host.part.toggle("open",n),r.header.classList.toggle("open",n)}}});r.header=new TimelineTrackHeaderElement,i(r.header).parts.toggle.addEventListener("click",(()=>{n({open:!t.open})})),assign(this,{class:"track-fragment",part:"track-container"},r.content=new from("div",{class:"track",part:"track"}),r.tracks=new from("div",{class:"tracks",part:"tracks"})),this.header=e.header,this.open=e.open}get events(){return i(this).parts.content.childNodes}get tracks(){return i(this).parts.tracks.childNodes}addEvent(e=null){return i(this).parts.content.appendChild(new TimelineEvent(e))}addTrack(e=null){let t=new TimelineTrack(e),{parts:r}=i(this);return this.classList.add("has-children"),this.part.add("has-children"),r.header.classList.add("has-children"),r.header.part.add("has-children"),i(r.header).parts.tracks.append(i(t).parts.header),r.tracks.append(t),t}get open(){}set open(e){}get header(){}set header(e){}}defineElementInternals(TimelineTrack,{open:Boolean,header:e=>e});class Timeline extends HTMLElement{constructor(e=null){e=Object(e),super();let{parts:t,shadowRoot:r,shadowStyleElement:n}=i(this,{props:{startTime:0,endTime:0,currentTime:0,zoom:1,msPerPx:6e4,rulerMsPerStep:36e5},parts:{header:{}},onPropsChange(e,r,n){switch(e){case"endTime":this.setStyle({"--TimelineClosing":n}),this.parts.ruler.redraw();case"currentTime":this.setStyle({"--TimelineCurrent":n});break;case"startTime":this.setStyle({"--TimelineOpening":n}),this.parts.ruler.redraw();break;case"msPerPx":this.setStyle({"--TimelineMsPerPx":n});break;case"rulerMsPerStep":this.setStyle({"--TimelineRulerMsPerStep":n}),t.ruler.repaint();break;case"zoom":this.setStyle({"--TimelineZoom":n}),this.parts.ruler.repaint()}}}),a=i(t.header).parts;t.workspace=new from("div",{class:"workspace is-flow-y"},new from("div",{class:"workspace-column has-track-headers"},t.legend=new from("div",{class:"legend",part:"legend"}),a.tracks=new from("div",{class:"tracks",part:"tracks"})),new from("div",{class:"workspace-column has-tracks is-flow-x"},t.ruler=new TimelineRuler,t.tracks=new from("div",{class:"tracks",part:"tracks"}),t.playhead=new from("div",{class:"playhead",part:"playhead"},new fromSVG("svg",{class:"playhead-handle",part:"playhead-handle",viewBox:"0 0 2 1"},new fromSVG("path",{d:"M 0,0 L 2,0 L 1,1"})),new from("div",{class:"playhead-line",part:"playhead-line"})))),n.textContent=this.constructor.cssText,r.prepend(n,t.workspace),this.endTime=e.endTime,this.currentTime=e.currentTime,this.startTime=e.startTime}connectedCallback(){let{parts:e}=i(this);e.ruler.repaint()}addTrack(e=null){let t=new TimelineTrack(e),{parts:r}=i(this);return i(r.header).parts.tracks.append(i(t).parts.header),r.tracks.append(t),t}removeTrack(e){let{parts:t}=i(this);return i(t.header).parts.tracks.removeChild(i(e).parts.header),t.tracks.removeChild(e),e}removeTracks(){for(let e of this.tracks)this.removeTrack(e)}get tracks(){let{parts:e}=i(this);return e.tracks.childNodes}set tracks(e){if(Array.isArray(e)){this.removeTracks();for(let t of e)this.addTrack(t)}}get startTime(){}set startTime(e){}get endTime(){}set endTime(e){}get currentTime(){}set currentTime(e){}get zoom(){}set zoom(e){}}function createContextState(e){const i=t(e);return[()=>r(i),function Provider(t){return n(i.Provider,{value:a(e)},t.children)}]}defineElementInternals(Timeline,{startTime:getTime,endTime:getTime,currentTime:getTime,zoom:e=>Number(e)||1}),Timeline.cssText=":host{--TimelineMsPerPx:60000;--TimelineZoom:1;--TimelineOpening:0;--TimelineClosing:0;--TimelineCurrent:0;--TimelineBorder:#bdbdbd;--TimelineCursor:#1a1a1a;--TimelineGap:.0625em;--TimelineGroup:#e0e0e0;--TimelinePlayhead:var(--TimelineEventBorder);--TimelineTrack:#e6e6e6;--TimelineTrackChild:#d6d6d6;--TimelineTrackHeaderSizeX:12.25em;--TimelineTrackPast:#d6d6d6;--TimelineTrackSizeY:2.75em;--TimelineTrackText:#0a0a0a;--TimelineRulerMsPerStep:3600000;--TimelineRulerSizeY:20px;--TimelineRulerMarkerSizeY:50%;--TimelineRulerMarkerMinorSizeY:25%;--TimelineEvent:#fafafa;--TimelineEventText:#0a0a0a;--TimelineEventBorder:var(--TimelineBorder);--ComputedTimelineElapsed:calc( var(--TimelineClosing,0) - var(--TimelineOpening,0));--ComputedTimelinePx:calc( var(--TimelineZoom,1)/var(--TimelineMsPerPx,60000)*1px )}button{appearance:none;color:inherit;font:inherit;line-height:inherit;background-color:#0000;border-width:0;margin:0;padding:0}svg{fill:currentColor}*{box-sizing:border-box}.workspace{grid-template:1fr/var(--TimelineTrackHeaderSizeX)1fr;grid-gap:var(--TimelineGap);max-height:100%;max-width:max-content;cursor:default;user-select:none;align-items:start;display:grid}.workspace-column{grid-template-rows:var(--TimelineRulerSizeY)minmax(var(--TimelineTrackSizeY),max-content);display:grid}.workspace-column>:nth-child(1){grid-area:1/1/2/2}.workspace-column>:nth-child(2){grid-area:2/1/3/2}.workspace-column>:nth-child(3){grid-area:1/1/3/2}.is-flow-x,.is-flow-y{scroll-behavior:smooth;scrollbar-width:none}.is-flow-x{overflow:auto hidden}.is-flow-y{overflow:hidden auto}.is-flow-x::-webkit-scrollbar,.is-flow-y::-webkit-scrollbar{width:0;height:0}.track,.track-header{height:var(--TimelineTrackSizeY);display:grid}.track>*{grid-area:1/1/2/2}.track-header{align-items:center;display:flex}.tracks:not(:empty),.track-fragment:not(:empty){grid-gap:1px;display:grid}.tracks:empty,.track-fragment:empty{display:contents}.tracks:not(:is(.open,.workspace-column)>*){display:none}.toggle{cursor:pointer;outline-offset:-1px;align-self:stretch;align-items:center;margin-right:.25em;padding:.25em;display:flex;overflow:hidden}.toggle:hover{background-color:#ffffff08}.toggle:focus-visible{outline-style:solid}.toggle:not(.has-children>*>*){visibility:hidden}.toggle-symbol{width:1em}.toggle-symbol:where(.open>*>.toggle *){rotate:90deg}.event{width:calc( var(--TimelineEventExpanseC,0)*var(--ComputedTimelinePx,1px));white-space:nowrap;translate:calc( var(--TimelineEventOpeningC,0)*var(--ComputedTimelinePx,1px))0px;--TimelineEventExpanseC:calc(var(--TimelineEventClosing,0) - var(--TimelineEventOpening,0));--TimelineEventOpeningC:calc(var(--TimelineEventOpening,0) - var(--TimelineOpening,0));--TimelineEventClosingC:calc(var(--TimelineEventClosing,0) - var(--TimelineOpening,0));background:#fafafa;border-radius:.1875em;align-items:center;padding:.5em;display:grid;box-shadow:inset 0 0 0 1px #3d3d3d}.event-title{font-size:.875em;line-height:1.14286;overflow:hidden}.event-subtitle{font-size:.75em;line-height:1;overflow:hidden}.playhead{width:.75em;color:#00000073;translate:calc( ( var(--TimelineCurrent,0) - var(--TimelineOpening))*var(--ComputedTimelinePx,1px))0px;grid-template-rows:.75em 1fr;margin-left:-.375em;display:grid}.playhead-handle{width:100%;grid-area:1/1/2/3;margin-left:.5px}.playhead-line{width:1px;background:linear-gradient(#0000 calc(.375em - .5px),currentColor calc(.375em - .5px));grid-area:1/1/3/3;margin-left:.375em}.has-tracks .ruler,.has-tracks .track{width:calc( var(--ComputedTimelineElapsed,0)*var(--ComputedTimelinePx,1px))}.workspace{--depth:0;--box-shadow-1:0 0 0 0 inset;--box-shadow-2:0 0 0 0 inset;--darken:#0000}.tracks .tracks{--depth:calc(var(--depthC) + 1)}.tracks .track-fragment{--depthC:var(--depth)}.track,.track-header{box-shadow:var(--box-shadow-1),var(--box-shadow-2)}.tracks .tracks :is(.track,.track-header){--darken:hsl(0 0% 0%/calc(4% + 4%*var(--depth)))}.track-header{padding-left:calc(var(--depth)*.5em);background:linear-gradient(var(--darken),var(--darken)),linear-gradient(var(--TimelineTrack),var(--TimelineTrack))}.track{background:linear-gradient(var(--darken),var(--darken)),linear-gradient(90deg,var(--TimelineTrackPast)calc( ( var(--TimelineCurrent,0) - var(--TimelineOpening))*var(--ComputedTimelinePx,1px)),var(--TimelineTrack)calc( ( var(--TimelineCurrent,0) - var(--TimelineOpening))*var(--ComputedTimelinePx,1px)))}.has-children .track-fragment:nth-child(1)>:is(.track,.track-header){--box-shadow-1:var(--TimelineNestedTrackOpeningShadow)}.has-children .track-fragment:not(.has-children):nth-last-child(1)>:is(.track,.track-header){--box-shadow-2:var(--TimelineNestedTrackClosingShadow)}.ruler{width:var(--ComputedWidth);color:currentColor;--ComputedWidth:calc( var(--ComputedTimelineElapsed,0)*var(--ComputedTimelinePx,1px));display:flex;overflow:hidden}.ruler-step{width:var(--ComputedWidth);text-indent:12.5%;background:linear-gradient(90deg,var(--TimelineRulerMarkerColor,CurrentColor)0 1px,transparent 0)no-repeat 0% 100%/50% var(--TimelineRulerMarkerSizeY,50%),linear-gradient(90deg,var(--TimelineRulerMarkerColor,CurrentColor)0 1px,transparent 0)no-repeat calc(100%/3)100%/25% var(--TimelineRulerMarkerMinorSizeY,25%),linear-gradient(90deg,var(--TimelineRulerMarkerColor,CurrentColor)0 1px,transparent 0)no-repeat calc(200%/3)100%/25% var(--TimelineRulerMarkerMinorSizeY,25%),linear-gradient(90deg,var(--TimelineRulerMarkerColor,CurrentColor)0 1px,transparent 0)no-repeat 100% 100%/25% var(--TimelineRulerMarkerMinorSizeY,25%);--ComputedWidth:calc( var(--TimelineRulerMsPerStep,3600000)*var(--ComputedTimelinePx));flex-shrink:0;font-size:.75em;line-height:1}";function Timeline(t){return e.createElement(c,{},e.createElement(TimelineContent,t))}function TimelineContent(t){let[r,n]=o(),a=useCallbackRef((e=>{if(e){let t=[...r.tracks].map((e=>{let t=new DocumentFragment;return"string"==typeof e.header?t.append(e.header):t.append(...e.header.childNodes),{open:!1,header:t}}));e.tracks=t}}));return e.createElement(s,{...t,ref:a})}customElements.get("web-timeline")||customElements.define("web-timeline",Timeline);let s=function createComponent(t,r){let n=Object.assign(Object.create(null),r),a=e.forwardRef(((r,a)=>{let i={},l={ref(e){if(e)for(let t in i)e[t]=i[t];"function"==typeof a?a(e):a&&(a.current=e)}};for(let e in r)(e in n?i:l)[e]=r[e];return e.createElement(t,l,r.children)}));return a.displayName=t,a}("web-timeline",{tracks:1,startTime:1,endTime:1,currentTime:1,zoom:1});const[o,c]=createContextState({tracks:new Set});function TimelineTrack(t){return e.createElement(m,{},e.createElement(TimelineTrackContent,t))}function TimelineTrackContent(t){o(),d();const r=useCallbackRef((e=>{console.log(1,e)}));return e.createElement(m,{},e.cloneElement(t.children,{ref:r}))}const[d,m]=createContextState({open:!1,header:new DocumentFragment}),TimelineTrackHeader=t=>{const r=useCallbackRef((e=>{let t=new DocumentFragment;e&&t.append(...e.childNodes)}));return e.createElement("noscript",{ref:r},t.children)};function useCallbackRef(t){const r=e.useRef(t);return e.useEffect((()=>{r.current=t})),e.useMemo((()=>(...e)=>r.current?.(...e)),[])}export{Timeline,s as TimelineComponent,Timeline,TimelineEvent,TimelineTrack,TimelineTrack,TimelineTrackHeader};
